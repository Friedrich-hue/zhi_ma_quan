# 知马圈（马来西亚）微信H5商城 MVP 方案（v0）

## 1. 背景与目标

为马来西亚矿泉水一级经销商搭建一套 **微信内 H5 商城**，用于线上售卖与订单处理；前端基于 `uni-app`，后续可复用同套业务逻辑编译到 **小程序/APP**。

本阶段目标聚焦：

- **卖货**：用户快速选购、下单、支付（微信H5）
- **履约前的订单管理**：管理员可在后台查看与处理订单
- **多语言**：客户端 UI 支持中英文；管理端仅中文

## 2. 端与角色

- **客户端（H5，优先微信环境）**
  - 中/英文 UI
  - 必须登录后才能下单
- **管理端（后台）**
  - 仅中文 UI
  - 订单与商品、地址相关管理

## 3. 登录与账号体系（重要约束）

### 3.1 登录优先级（按运行环境判断）

1. **微信环境**：优先使用 **微信 OAuth 登录**（微信内 WebView）
2. **非微信环境**：使用 **邮箱注册/登录**（次选方案）

### 3.2 下单与身份标识

- **下单必须登录**
- **不以手机号为主键**，不要求绑定手机号
- 账号主键建议：`user_id`（系统生成）+ 登录凭据（微信 unionid/openid / email）

### 3.3 需要落地的实现点（后端/前端）

- 识别运行环境：是否微信内置浏览器（UA 判断）+ H5 平台判断
- 微信 OAuth：
  - 获取 code → 服务端换取用户标识 → 建立会话/发 token
  - 需要 **回调地址**、**状态校验**（state）、**登录幂等**
- 邮箱登录：
  - 注册/登录/找回密码（可复用 `uni-id-pages` 能力）

## 4. 多语言（客户端启用，管理端仅中文）

### 4.1 客户端语言策略

- **默认**：优先根据系统语言（`uni.getLocale()` 等）
- **用户可选择语言**：记忆用户选择（storage）
- **兜底**：中文（`zh-Hans`）

### 4.2 多语言范围

- **仅 UI 多语言**
- **暂不做动态数据字段多语言**（如商品名/描述等仍以单语言存储与展示）

### 4.3 管理端语言策略

- **只启用中文**（不提供语言切换入口）

## 5. 商品与售卖（MVP 范围）

### 5.1 商品展示（用户端）

- 商品列表（分类/搜索可先简化）
- 商品详情（图片、规格/包装、价格、促销价/原价）
- 加购/数量调整

### 5.2 商品管理（管理端）

- 新增/编辑商品
- 上下架
- 价格（原价、售价、促销价）
- 图片管理
- 规格/包装信息（如 9.5L×2/箱、1.5L×12）

### 5.3 库存与仓库（本期不做，但要预留）

当前阶段：

- **不做库存扣减、不做仓库/采购**，下单不拦截库存

需要预留的扩展窗口（字段/结构建议）：

- 商品层面预留：`stock_mode`（none/simple/multi_warehouse）、`stock_qty`、`warehouse_id` 等
- 订单项预留：`warehouse_id`、`procurement_status`、`inventory_reserved` 等

## 6. 地址与配送信息（MVP）

### 6.1 用户侧地址

- 新增/编辑/删除收货地址
- 结算时选择地址

### 6.2 管理侧地址管理

本期至少满足：

- 可查询订单地址/用户地址
- 可对异常地址做备注/纠错（如需）

（配送范围、运费模板、时段等可在后续迭代）

## 7. 订单（核心）

### 7.1 用户侧订单能力

- 创建订单（结算提交）
- 订单列表/详情
- 支付状态展示

### 7.2 管理端订单能力

MVP 需要：

- 订单列表（筛选：时间、状态、用户、订单号）
- 订单详情（商品、数量、金额、地址）
- 订单状态更新（最少：待支付/已支付/已取消/已完成）
- 订单备注（客服/处理备注）

### 7.3 订单状态（建议初版）

- `PENDING_PAYMENT` 待支付
- `PAID` 已支付
- `CANCELLED` 已取消（含超时取消/手动取消）
- `COMPLETED` 已完成（人工置完成即可）

后续可扩展：

- `PROCESSING` 备货中、`DELIVERING` 配送中、退款相关状态等

## 8. 支付（本期：微信 H5）

### 8.1 支付渠道

- **仅对接微信 H5 支付**（本期）

### 8.2 关键实现要求（必须考虑）

- 支付创建：服务端创建支付单/统一下单
- 支付回调：服务端验签、**幂等处理**、更新订单状态
- 前端回跳：查询订单支付状态（轮询/查询接口），防止仅靠前端回调
- 防重复支付：同一订单重复拉起支付时的处理策略

## 9. 非目标（明确不做）

本期不做：

- 库存/仓库/采购
- 多仓库履约
- 商品/订单的动态内容多语言
- 复杂营销（优惠券、积分、分销等）
- 配送时段/运费模板/区域围栏（可后续规划）

## 10. 需要进一步补齐的决策清单（下一轮）

- 微信 OAuth：
  - 是否要求公众号/开放平台绑定？回调域名如何配置？
  - 用户从非微信环境访问 H5 时的体验：是否提示“请在微信打开”还是直接走邮箱登录？
- 支付：
  - 支付失败/取消的 UX（是否回购物车/订单页）
  - 订单支付超时策略（超时自动取消时间：15/30 分钟？）
- 订单履约：
  - 管理端“完成订单”的标准：发货/送达谁来确认？
- 地址：
  - 地址字段规范（马来西亚州/邮编是否要做标准化下拉）

---

变更记录：

- v0：根据当前沟通形成初版方案（登录优先微信OAuth、非微信邮箱；下单必须登录不绑手机号；客户端UI中英文；本期仅商品/订单/地址；支付仅微信H5；库存与仓库后续迭代预留）

